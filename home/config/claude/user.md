# Claude Code 設定

日本語で回答
コメントを残すときは端的な英語

## 開発哲学

### 関数型プログラミング
- **中核原則**: すべての言語で関数型プログラミングの概念を適用する
- 可能な限り不変データ構造と純粋関数を選択
- 高階関数、合成、宣言的パターンを活用
- 副作用を避ける；必要な場合は分離して明示的にする
- 文よりも式を優先

### アーキテクチャ・設計
- **DDD・クリーンアーキテクチャ**: 実際の問題を解決する場合にのみ適用し、教条的にならない
- ドメインモデリングとレイヤー間の明確な境界に重点を置く
- 過度な設計を避け、シンプルさと保守性を優先
- 理論的な完璧さではなく、実際の要件から設計を導出

### 型システムの活用
- **ドキュメント重視の型付け**: 型は生きたドキュメントとして機能すべき
- パブリックAPI、関数シグネチャ、複雑なデータ構造には明示的な型を記述
- ローカル変数や自明な文脈では型推論を活用
- 型は意図を明確にし、エラーを防ぐためのもので、作業負荷を増やすためではない

### コード品質
- **自己文書化コード**: 大量のコメントなしで読めるコードを書く
- 変数、関数、モジュールには意味のある名前を使用
- 意図を明確に表現するコード構造
- コメントは「なぜ」のためのもので「何を」ではない - 控えめに、目的を持って使用
- 明確な責任を持つ小さく焦点を絞った関数を優先

## 環境・ツール

### プロジェクト設定
- **主要環境**: 再現可能な開発環境のためのNix + direnv
- **最初の確認**: プロジェクト設定を理解するため、常に`flake.nix`を確認
- Nix設定が存在しない場合、代替案を提案する前に確認する
- 既存のプロジェクト規約とツール選択を尊重

### 開発ワークフロー
- 環境の有効化には`nix develop`または`direnv allow`を使用
- 命令的セットアップスクリプトよりも宣言的設定を優先
- チームメンバー間での環境再現性を維持

## テスト戦略

### テストの考え方
- **純粋関数中心**: FPアプローチにより、テストは書きやすいはず
- **ユニットテスト重視**: 本当に必要なもの以外は基本的にユニットテストで担保
- **TDD対応**: 重要だが、書き捨てコードも多いため、指示があるまでテストは書かない
- 純粋関数の特性を活かしたテスト設計

## エラーハンドリング
- **型ベースアプローチ**: Option、Resultのような型を基本とする
- 例外よりも明示的なエラー型を優先
- エラーケースを型レベルで表現し、コンパイル時に検証

## パフォーマンス vs 純粋性
- **判断基準**: 迷った場合は純粋性とコードの美しさを重視
- 文脈に応じた柔軟な判断
- 最適化が必要な場合でも、可能な限り関数型の原則を維持

## 個人開発での注意点

### 既存コードベースの尊重
- **最重要**: 既存の書き方と規約を最優先で守る
- 新しい機能追加時も既存パターンに合わせる
- リファクタリング提案は既存設計を理解した上で行う
- 一貫性を保つことでコードベースの品質を維持

### プロジェクト分析手順
1. **環境確認**: `flake.nix`、`shell.nix`、`.envrc`、`README.md`の内存在するものをチェック
2. **既存パターン理解**: 現在のコーディングスタイルと規約を把握
3. **アーキテクチャ把握**: ドメイン境界とレイヤー分離を特定
4. **型戦略評価**: 現在の型付け戦略と一貫性を評価
5. **関数型パターン**: FP概念を適用する機会を探す

## 対話スタイル
- 日本語での対話を基本とする（コードコメントは英語でも可）
- アーキテクチャ上の決定とトレードオフを説明
- FP原則に沿ったリファクタリング機会を提案
- 理論的ベストプラクティスと実践的制約のバランスを取る
- 完全な書き直しではなく、段階的改善に重点を置く
